/*! scroll-load tianxiangbing http://www.lovewebgames.com/jsmodule/scroll-load.html 2015-04-03 */
!function(a){window.ScrollLoad=function(){this.container,this.url,this.param,this.page=1,this.pagename="page",this.loadmore},ScrollLoad.prototype={init:function(b){this.settings=a.extend({},b),this.load=this.settings.loadmore||a('<div class="ui-loading">点击加载更多</div>'),this.scrolltrigger=a(this.settings.scrolltrigger||window),this.container=this.settings.container,0==this.container.children().size()&&this.container.append('<div class="scroll-content"/>'),this.container.append(this.load),this.url=this.settings.url,this.page=this.settings.page||1,this.pagename=b.pagename||"page",this.param=a.extend({},this.settings.param),this.param[this.pagename]=this.page,this.bindEvent(),this.checkPosition()},touch:function(b,c){var d;a(b).on("click",c),a(b).on("touchmove",function(){d=!0}).on("touchend",function(a){if(a.preventDefault(),!d){var b=c.call(this,a,"touch");b||(a.preventDefault(),a.stopPropagation())}d=!1})},bindEvent:function(){if(this.container.size()){var a=this;a.settings.scrollLoad&&a.scrolltrigger.scroll(function(){a.checkPosition()}),a.touch(a.load,function(){a.ajaxData()})}},checkPosition:function(){var a=this.container.offset(),b=this.container.height(),c=window.innerHeight||document.documentElement.clientHeight,d=(window.innerWidth||document.documentElement.clientWidth,document.body.scrollTop||document.documentElement.scrollTop),e=this;a.top+b<=c+d&&e.ajaxData()},ajaxData:function(){var b=this;return b.ajax?!1:(b.ajax=!0,this.load.html("正在加载中..."),this.param[this.pagename]=this.page,void a.ajax({url:b.url,type:b.settings.type||"get",dataType:"json",cache:!1,data:b.param,timeout:3e4,success:function(a){b.settings.format?b.settings.format(this.container,a):b.format(a),b.page++},complete:function(){setTimeout(function(){b.ajax=!1},1e3),b.load.html("点击加载更多")}}))},format:function(b){b.data&&b.data.length||(b.nodata=!0,this.load.remove());var c="string"==typeof this.settings.tpl?a(this.settings.tpl):this.settings.tpl,d=c.html(),e=Handlebars.compile(d),f=e(b);this.container.children().first().append(f),this.settings.callback&&this.settings.callback(this.container,b)}}}(window.Zepto||window.jQuery),function(a){a.fn.ScrollLoad=function(b){var c=[];return a(this).each(function(){var d=new ScrollLoad,e=a.extend({container:a(this)},b);d.init(e),c.push(d)}),c}}(window.Zepto||window.jQuery);